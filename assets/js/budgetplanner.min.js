const tables=["table-income","table-outcome-loan","table-outcome-worked","table-outcome-houses","table-outcome-childs","table-outcome-varied"],colorPalettes=["#fd7f6f","#7eb0d5","#b2e061","#bd7ebe","#ffb55a","#ffee65","#beb9db","#fdcce5","#8bd3c7"];var globalResult;function loadData(e,t){removeAllRows(),t.forEach((t=>{const a=(t.split("-")[2]?t.split("-")[2]:t.split("-")[1]).replace("outcome","").toLowerCase(),n=document.getElementById(t);if(!n)return void console.error(`Table element ${t} not found.`);const l=e[a];l?l.list.forEach((e=>{var t=n.getElementsByTagName("tbody")[0],a=t.insertRow(t.rows.length),l=a.insertCell(0),o=a.insertCell(1),r=a.insertCell(2),d=document.createElement("input");d.type="text",d.name="title[]",d.placeholder="masukan label",d.value=e.title,l.appendChild(d);var i=document.createElement("input");i.type="text",i.name="amount[]",i.classList.add("currency"),i.placeholder="0",i.value=numberFormatter(e.nominal,!0),o.classList.add("element-box"),o.innerHTML='<div class="icons">Rp</div>',o.appendChild(i);var c=document.createElement("button");c.innerHTML='<i class="fa fa-trash-o"></i>',c.onclick=function(){deleteRow(this)},r.appendChild(c)})):console.error(`Data for ${a} not found in sample.`)}))}function removeAllRows(){tables.forEach((e=>{for(var t=document.getElementById(e).getElementsByTagName("tbody")[0];t.rows.length>0;)t.deleteRow(0)}))}function addRow(e){var t=document.getElementById(e).getElementsByTagName("tbody")[0],a=t.insertRow(t.rows.length),n=a.insertCell(0),l=a.insertCell(1),o=a.insertCell(2),r=document.createElement("input");r.type="text",r.name="title[]",r.placeholder="masukan label",n.appendChild(r);var d=document.createElement("input");d.type="text",d.name="amount[]",d.classList.add("currency"),d.placeholder="0",l.classList.add("element-box"),l.innerHTML='<div class="icons">Rp</div>',l.appendChild(d);var i=document.createElement("button");i.innerHTML='<i class="fa fa-trash-o"></i>',i.onclick=function(){deleteRow(this)},o.appendChild(i),r.focus()}function deleteRow(e){var t=e.parentNode.parentNode;t.parentNode.removeChild(t)}function retrieveData(e){for(var t=document.getElementById(e).getElementsByTagName("tr"),a=[],n=0,l=1;l<t.length;l++){var o=t[l].getElementsByTagName("td"),r=o[1].querySelector("input").value?o[1].querySelector("input").value:"0";n+=parseInt(toNumber(r));var d={title:o[0].querySelector("input").value,nominal:parseInt(toNumber(r))};a.push(d)}return{list:a,total:n}}function calculate(){const e={calc:{outcomeTotal:0,outcomeFixedTotal:0,leftover:0}};return tables.forEach((t=>{const a=(t.split("-")[2]?t.split("-")[2]:t.split("-")[1]).replace("outcome","").toLowerCase();e[a]=retrieveData(t),e.calc.outcomeFixedTotal+="income"!=a&&"varied"!=a?e[a].total:0,e.calc.outcomeTotal+="income"!=a?e[a].total:0})),e.calc.leftover=e.income.total-e.calc.outcomeTotal,e}function showResult(){$("#table-bp-result tbody").html("");const e=globalResult=savedToLocal("load-1",calculate());$("#table-bp-result").addClass("margin-bottom-xl"),$("#table-bp-result tbody").append(`\n    <tr class="table_header">\n        <th colspan="2">Ringkasan Budget Bulanan Anda</th>\n    </tr>\n    <tr>\n        <td>Total Pendapatan</td>\n        <td>Rp${numberFormatter(e.income.total)}</td>\n    </tr>\n    <tr>\n        <td>Total Pengeluaran</td>\n        <td>Rp${numberFormatter(e.calc.outcomeTotal)}</td>\n    </tr>\n    <tr>\n        <td>Total Sisa</td>\n        <td>Rp${numberFormatter(e.calc.leftover)}</td>\n    </tr>\n    <tr class="table_header">\n        <th colspan="2">Rincian Pengeluaran Bulanan Anda</th>\n    </tr>\n    <tr>\n        <td>Hutang & Cicilan</td>\n        <td>Rp${numberFormatter(e.loan.total)}</td>\n    </tr>\n    <tr>\n        <td>Terkait Pekerjaan</td>\n        <td>Rp${numberFormatter(e.worked.total)}</td>\n    </tr>\n    <tr>\n        <td>Terkait Rumah Tangga</td>\n        <td>Rp${numberFormatter(e.houses.total)}</td>\n    </tr>\n    <tr>\n        <td>Tanggunan Anak</td>\n        <td>Rp${numberFormatter(e.childs.total)}</td>\n    </tr>\n    <tr>\n        <td>Total Pengeluaran Tetap</td>\n        <td>Rp${numberFormatter(e.calc.outcomeFixedTotal)}</td>\n    </tr>\n    <tr>\n        <td>Total Pengeluaran Tidak Tetap</td>\n        <td>Rp${numberFormatter(e.varied.total)}</td>\n    </tr>\n    `),drawChartBreakdown(e),breakdownPPChart&&(breakdownPPChart.canvas.removeEventListener("click",handleChartClick),breakdownPPChart.destroy(),$("#breakdownPPChart").hide()),breakdownDetailPPChart&&(breakdownDetailPPChart.destroy(),$("#breakdownDetailPPChart").hide()),$("#to-anggaran").show(),autoScrollDown("#div-result")}function exportData(){const e=calculate();var t=JSON.stringify(e),a=new Blob([t],{type:"application/json"}),n=URL.createObjectURL(a),l=document.createElement("a");l.href=n,l.download="myplanner-"+Date.now()+".json",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(n)}function confirmClearData(){window.confirm("Apakah Anda yakin ingin menghapus data dari dataset tabel ini? (Dataset ini akan terhapus dari browseer storage anda.)")&&(localStorage.removeItem("load-1"),removeAllRows())}getDataLocal("load-1")&&loadData(getDataLocal("load-1"),tables);let form=document.querySelector("#upload"),file=document.querySelector("#file");function handleSubmit(e){if(e.preventDefault(),!file.value.length)return;let t=new FileReader;t.onload=logFile,t.readAsText(file.files[0])}function logFile(e){let t=e.target.result,a=JSON.parse(t);loadData(a,tables),console.log("json",a)}var breakdownChart,breakdownPPChart,breakdownDetailPPChart;function drawChartBreakdown(e){breakdownChart&&(breakdownChart.canvas.removeEventListener("click",handleChartClick),breakdownChart.destroy());let t=[e.income.total,e.calc.outcomeTotal];const a=$("#breakdownChart");a.show();(breakdownChart=new Chart(a,{type:"pie",data:{labels:["Pendapatan","Pengeluaran"],datasets:[{backgroundColor:colorPalettes,data:t}]},options:{plugins:{title:{display:!0,text:"Break Down Chart",font:{size:16}},legend:{labels:{boxWidth:20}}}}})).canvas.addEventListener("click",(function(e){handleChartClick(e,breakdownChart)}))}function drawChartPPBreakdown(e){breakdownPPChart&&(1===e&&breakdownPPChart.canvas.removeEventListener("click",handleChartClick),breakdownPPChart.destroy());let t=globalResult,a=[],n=[],l="";0===e?(t=globalResult.income.list,Object.entries(t).forEach((([e,t])=>{"calc"!=e&&"income"!=e&&(a.push(t.title),n.push(t.nominal))})),l="Breakdown Detail Pendapatan",breakdownDetailPPChart&&(breakdownDetailPPChart.destroy(),$("#breakdownDetailPPChart").hide())):1===e&&(a=["Hutang dan Cicilan","Pekerjaan","Rumah Tangga","Tanggunan","Pengeluaran Tidak Tetap"],Object.entries(t).forEach((([e,t])=>{"calc"!=e&&"income"!=e&&n.push(t.total)})),l="Breakdown Pengeluaran");const o=$("#breakdownPPChart");o.show();breakdownPPChart=new Chart(o,{type:"pie",data:{labels:a,datasets:[{backgroundColor:colorPalettes,data:n}]},options:{plugins:{title:{display:!0,text:l,font:{size:16}},legend:{labels:{boxWidth:20}}}}}),1===e&&breakdownPPChart.canvas.addEventListener("click",(function(e){handleChartClick(e,breakdownPPChart)}))}function drawDetailChartPPBreakdown(e){let t;breakdownDetailPPChart&&breakdownDetailPPChart.destroy(),0===e?t=globalResult.loan.list:1===e?t=globalResult.worked.list:2===e?t=globalResult.houses.list:3===e?t=globalResult.childs.list:4===e&&(t=globalResult.varied.list);let a=[],n=[];Object.entries(t).forEach((([e,t])=>{"calc"!=e&&"income"!=e&&(a.push(t.title),n.push(t.nominal))}));const l=$("#breakdownDetailPPChart");l.show();breakdownDetailPPChart=new Chart(l,{type:"pie",data:{labels:a,datasets:[{backgroundColor:colorPalettes,data:n}]},options:{plugins:{title:{display:!0,text:"Breakdown Detail Pengeluaran",font:{size:16}},legend:{labels:{boxWidth:20}}}}})}function handleChartClick(e,t){const a=t.getElementsAtEventForMode(e,"nearest",{intersect:!0},!0)[0];a&&("breakdownChart"===t.canvas.id?drawChartPPBreakdown(a.index):"breakdownPPChart"===t.canvas.id&&drawDetailChartPPBreakdown(a.index))}form.addEventListener("submit",handleSubmit),$(".table-input").on("input",".currency",(function(){$(this).val(numberFormatter($(this).val(),!0))})),$(".util-menu").click((function(e){e.preventDefault(),$(this).parent().addClass("current"),$(this).parent().siblings().removeClass("current");var t=$(this).attr("data-tab");$(".tab-content").not(t).css("display","none"),$(t).is(":visible")?$(t).hide():$(t).fadeIn()})),$("#cnv-money").on("input",(function(){$(this).val(numberFormatter($(this).val(),!0));const e=toNumber($(this).val()),t=$("#cnv-interval-in").val();let a=0;"1"===t&&(a=30*e),"2"===t&&(a=4*e),"3"===t&&(a=e/4),"4"===t&&(a=e/12),a=Math.ceil(a),$("#cnv-hasil").val(numberFormatter(a))})),$("#cnv-interval-in").on("change",(function(){const e=toNumber($("#cnv-money").val()),t=$(this).val();let a=0;"1"===t&&(a=30*e),"2"===t&&(a=4*e),"3"===t&&(a=e/4),"4"===t&&(a=e/12),a=Math.ceil(a),$("#cnv-hasil").val(numberFormatter(a))}));